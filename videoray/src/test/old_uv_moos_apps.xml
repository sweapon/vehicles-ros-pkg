<?xml version="1.0" encoding="UTF-8"?>
<configurations> 
  <UVApp id="vrsim">
   <!-- Timeout value -->
   <watchdog timeout="10000" loop="1000" />
   <!-- Plugin configuration -->
   <plugin name="uvsim-plug" id="falcon"/>
   <!-- open loop surge force during LF -->
   <OpenLoopTauX>10</OpenLoopTauX>
   
   <saveIdentification>1</saveIdentification>
   <param name="measurement-delay" value="42" />
   <param name="measurement-frequency" value="21" />

   
   <!-- Identification parameters -->
   <heading-so tau="2" angle="15" />
   <depth-so tau="2" depth="0.5" />
   
   <!-- The environment initialization -->
   <!-- <current-force>[3](10,0,0)</current-force> -->
      
   <!-- Vehicle simulation parameters --> 
   <VehicleModel id="falcon">
    <sampling-time>0.1</sampling-time>
    <mass>20</mass>
      <!-- Navigation parameters -->
   
    <gravity>10</gravity>
    <inertia-matrix>diag([3](30,30,3.523))</inertia-matrix>
    <rg>[3](0,0,0)</rg>
    <rb>[3](0,0,0)</rb>
    <rho>1025</rho>
    <lift-force>200</lift-force>
    <added-mass>diag([6](20,80,5.4857,15,30,0))</added-mass>
    <linear-damping>diag([6](100,100,11.1815,400,300,1.49))</linear-damping>
    <quadratic-damping>diag([6](0,0,0,0,0,0))</quadratic-damping>
    <eta0>[6](10,10,0,0,0,0)</eta0>
    <nu0>[6](0,0,0,0,0,0)</nu0>
    <coupled>0</coupled>
    
    <current>[3](0,0,0)</current>
    
    <!-- <process-noise>[6](0.1,0.1,0.1,0.1,0.1,0.1)</process-noise> -->
    <!-- <measurement-noise>[6](1,1,0.1,0.01,0.01,0.01)</measurement-noise> -->
   </VehicleModel> 
     
    
   <!-- Controller parameters -->
    <param name="Ts" value="0.1" />
    
    <!-- dH controller parameters -->
    <param name="w_h" value="0.7" />
    <param name="attack_angle" value="45" />
    <!-- dV controller parameters -->
    <param name="w_v" value="0.3" />
    <param name="Xi" value="0" />
    
    <!-- Yaw controller parameters -->
    <param name="w_r" value="0.7" />
    <!-- Depth controller parameters -->
    <param name="w_w" value="0.3" />
    
    <!-- Yaw model parameters --> 
    <!-- <param name="alpha_r" value="80" />
    <param name="beta_r" value="300" />
    <param name="Max_N" value="300" /> -->
    <!-- Goldrake parameters for simulation -->
    <param name="alpha_r" value="3.523" />
    <param name="beta_r" value="1.49" />
    <param name="Max_N" value="3.5" />
    
    <!-- Depth model parameters -->  
    <param name="alpha_w" value="25.4857" />
    <param name="beta_w" value="11.1815" />
    <param name="Max_Z" value="3" />
    
	<line T1="[3](0,0,0)" T2="[3](1,1,0)" />
  	<!-- measurement vector <z,psi,dV,dH> -->
  	<param name="R" value="diag([4](0.1,0.02,1,1))" />
  	<param name="V" value="diag([4](1,1,1,1))" />
  	<!-- noise vector <u,w,r,b,vertCurrent,horzCurrent> -->
  	<param name="Q" value="diag([6](0.1,0.1,0.1,0.1,0.1,0.1))" />
  	<param name="W" value="[10,6]((1,0,0,0,0,0),
				(0,1,0,0,0,0),
				(0,0,1,0,0,0),
				(0,0,0,0,0,0),
				(0,0,0,0,0,0),
 				(0,0,0,0,0,0),
 				(0,0,0,0,0,0),
				(0,0,0,1,0,0),
				(0,0,0,0,1,0),
				(0,0,0,0,0,1))" />  
	<!-- filter options -->
	<param name="initial-state" value="[10](0,0,0,0,0,0,0,0,0,0)" />
  	<param name="sampling-time" value="0.1" /> 

	<moduleConfig name="MissionControl" type="LabustMissionControl">
			<state name="Ready" initial="true">
				<output>
					<param name="Action" value="None"/>	
				</output>
				<transition state="SetupIdentHeading">
					<param name="Mode" value="Identification"/>
				</transition>																			
			</state>

			<state name="SetupIdentDepth">
				<output>
					<param name="Action" value="SetupIdent"/>
					<param name="Amplitude" value="1"/>
					<param name="Hysteresis" value="0.1"/>
					<param name="StateToIdentify" value="8"/>
					<param name="SamplingPeriod" value="0.1"/>	
				</output>
				<transition state="IdentDepth">
					<param name="Mode" value="Identification"/>
				</transition>																			
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>							
			</state>

			<state name="IdentDepth">
				<output>
					<param name="Action" value="Ident"/>	
				</output>
				<transition state="SetupIdentHeading">
					<param name="Mode" value="Identification"/>
					<param name="TAU-Z" value="0"/>
					<param name="TAU-Z" value="0"/>
				</transition>																			
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>						
			</state>

			<state name="SetupIdentHeading">
				<output>
					<param name="Action" value="SetupIdent"/>
					<param name="Amplitude" value="2"/>
					<param name="Hysteresis" value="0.05"/>
					<param name="StateToIdentify" value="11"/>
					<param name="SamplingPeriod" value="0.1"/>	
				</output>
				<transition state="IdentHeading">
					<param name="Mode" value="Identification"/>
				</transition>																			
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>							
			</state>

			<state name="IdentHeading">
				<output>
					<param name="Action" value="Ident"/>	
				</output>
				<transition state="Tune">
					<param name="Mode" value="Identification"/>
					<param name="TAU-N" value="0"/>
					<param name="TAU-N" value="0"/>
				</transition>																			
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>						
			</state>

			<state name="Tune">
				<output>
					<param name="Action" value="Tune"/>	
				</output>
				<transition state="Saving">
					<param name="Mode" value="Identification"/>
				</transition>																			
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>							
			</state>			


			<state name="Saving">
				<output>
					<param name="Action" value="Save"/>	
					<param name="SaveDepthIdent" value="0"/>	
					<param name="SaveHeadingIdent" value="1"/>	
				</output>
				<transition state="Done">
					<param name="Mode" value="Identification"/>
				</transition>	
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>	
			</state>	

			<state name="Done">
				<output>
					<param name="Action" value="Done"/>	
				</output>
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>	
			</state>																		
		</moduleConfig>


  </UVApp>

<UVApp id="vr">
   <!-- Timeout value -->
   <watchdog timeout="10000" loop="1000" />
   <!-- Plugin configuration -->
   <plugin name="videoray-plug" />
   <!-- open loop surge force during LF -->
   <OpenLoopTauX>2.5</OpenLoopTauX>

    <param name="measurement-delay" value="42" />
    <param name="measurement-frequency" value="21" />
   
   <!-- Identification parameters -->
   <heading-so tau="4" angle="15" />
   <depth-so tau="2" depth="0.5" />
   <vr4>1</vr4>
      
   <!-- VR configuration -->
   	<!-- Serial config parameters -->
   	<param name="PortName" value="/dev/ttyUSB2"/>
	<param name="BaudRate" value="115200"/>
	<param name="FlowControl" value="none"/>
	<param name="Parity" value="none"/>
	<param name="StopBits" value="1"/>
 	<param name="DataBits" value="8"/>
 	 	
 	 <!-- Revolution limits -->
 	 <revLimit min="-220" max="220" />
 	 <lightLimit min="0" max="100" />
 	 	
 	 <!-- Thruster mappings -->
 	 <!-- <thruster-param an="0.0004872" bn="0.0001389" /> -->
 	 <!-- for vr4 divide by 0.21 -->
 	 <thruster-param an="0.0003" bn="0.0001389" />
 	 <!-- <thruster-param an="0.001428571" bn="0.000661429" /> -->
 	 	
 	 <!-- Depth mappings -->
 	 <depth-map low="1017" high="313" psiHigh="50" psiLow="0" />
   
         <!-- Controller parameters -->
    <param name="Ts" value="0.1" />
    
    <!-- dH controller parameters -->
    <param name="w_h" value="0.7" />
    <param name="attack_angle" value="45" />
    <!-- dV controller parameters -->
    <param name="w_v" value="0.3" />
    <param name="Xi" value="0" />
    
    <!-- Yaw controller parameters -->
    <param name="w_r" value="0.3" />
    <!-- Depth controller parameters -->
    <param name="w_w" value="0.3" />
    
    <!-- Yaw model parameters --> 
    <!-- <param name="alpha_r" value="80" />
    <param name="beta_r" value="300" />
    <param name="Max_N" value="300" /> -->
    <!-- Goldrake parameters for simulation -->
    <param name="alpha_r" value="9.177863" />
    <param name="beta_r" value="1.295085" />
    <param name="Max_N" value="6" />
    
    <!-- Depth model parameters -->  
    <param name="alpha_w" value="25.4857" />
    <param name="beta_w" value="1.1815" />
    <param name="Max_Z" value="3" />
    
	<line T1="[3](0,0,0)" T2="[3](1,1,0)" />
  	<!-- measurement vector <z,psi,dV,dH> -->
  	<param name="R" value="diag([4](0.1,0.02,1,1))" />
  	<param name="V" value="diag([4](1,1,1,1))" />
  	<!-- noise vector <u,w,r,b,vertCurrent,horzCurrent> -->
  	<param name="Q" value="diag([6](0.1,0.1,0.1,0.1,0.1,0.1))" />
  	<param name="W" value="[10,6]((1,0,0,0,0,0),
				(0,1,0,0,0,0),
				(0,0,1,0,0,0),
				(0,0,0,0,0,0),
				(0,0,0,0,0,0),
 				(0,0,0,0,0,0),
 				(0,0,0,0,0,0),
				(0,0,0,1,0,0),
				(0,0,0,0,1,0),
				(0,0,0,0,0,1))" />  
	<!-- filter options -->
	<param name="initial-state" value="[10](0,0,0,0,0,0,0,0,0,0)" />
  	<param name="sampling-time" value="0.1" /> 

	<moduleConfig name="MissionControl" type="LabustMissionControl">
			<state name="Ready" initial="true">
				<output>
					<param name="Action" value="None"/>	
				</output>
				<transition state="SetupIdentHeading">
					<param name="Mode" value="Identification"/>
				</transition>																			
			</state>

			<state name="SetupIdentDepth">
				<output>
					<param name="Action" value="SetupIdent"/>
					<param name="Amplitude" value="4"/>
					<param name="Hysteresis" value="0.5"/>
					<param name="StateToIdentify" value="8"/>
					<param name="SamplingPeriod" value="0.1"/>	
				</output>
				<transition state="IdentDepth">
					<param name="Mode" value="Identification"/>
				</transition>																			
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>							
			</state>

			<state name="IdentDepth">
				<output>
					<param name="Action" value="Ident"/>	
				</output>
				<transition state="SetupIdentHeading">
					<param name="Mode" value="Identification"/>
					<param name="TAU-Z" value="0"/>
					<param name="TAU-Z" value="0"/>
				</transition>																			
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>						
			</state>

			<state name="SetupIdentHeading">
				<output>
					<param name="Action" value="SetupIdent"/>
					<param name="Amplitude" value="4"/>
					<param name="Hysteresis" value="0.18"/>
					<param name="StateToIdentify" value="11"/>
					<param name="SamplingPeriod" value="0.1"/>
                                        	
				</output>
				<transition state="IdentHeading">
					<param name="Mode" value="Identification"/>
				</transition>																			
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>							
			</state>

			<state name="IdentHeading">
				<output>
					<param name="Action" value="Ident"/>	
				</output>
				<transition state="Tune">
					<param name="Mode" value="Identification"/>
					<param name="TAU-N" value="0"/>
					<param name="TAU-N" value="0"/>
				</transition>																			
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>						
			</state>

			<state name="Tune">
				<output>
					<param name="Action" value="Tune"/>	
				</output>
				<transition state="Saving">
					<param name="Mode" value="Identification"/>
				</transition>																			
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>							
			</state>			


			<state name="Saving">
				<output>
					<param name="Action" value="Save"/>	
					<param name="SaveDepthIdent" value="1"/>	
					<param name="SaveHeadingIdent" value="1"/>	
				</output>
				<transition state="Done">
					<param name="Mode" value="Identification"/>
				</transition>	
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>	
			</state>	

			<state name="Done">
				<output>
					<param name="Action" value="Done"/>	
				</output>
				<transition state="Ready">
					<param name="Mode" value="!Identification"/>
				</transition>	
			</state>																		
		</moduleConfig>


  </UVApp>

  <!-- iUUVModem configuration -->
  <UUVModem id="default">
	 <param name="PortName" value="pts1"/>
	 <param name="BaudRate" value="4800"/>
	 <param name="FlowControl" value="none"/>
	 <param name="Parity" value="none"/>
	 <param name="StopBits" value="1"/>
 	 <param name="DataBits" value="8"/>
 	 
 	 <param name="packetNum" value="2" />
 	 <plugin name="whoi-plug"/>
  </UUVModem>
</configurations>

